<!DOCTYPE html><html lang="en" dir="ltr"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>99 Nights in the Forest Class Unlocker - Free Classes Script | Auto Farm</title>
    <meta name="description" content="Unlock any class in 99 Nights in the Forest! Free class unlocker, auto farm script, and class guide. Learn how to get your favorite classes fast with our working script.">
    <meta name="keywords" content="99 nights in the forest class, 99 nights in the forest classes, roblox 99 nights in the forest class, 99 nights in the forest class script, 99 nights in the forest class farm, survive 99 nights in the forest class, 99 nights in the forest class farm script, 99 nights in the forest classes guide, 99 nights in the forest class wiki, how to get classes in 99 nights in the forest, 99 nights in the forest class unlock, how to unlock class in 99 nights in the forest, 99 nights in the forest script auto class pastebin, 99 nights in the forest auto class script, 99 nights in the forest auto class, 99 nights in the forest script auto class download, 99 nights in the forest auto farm class script, 99 nights in the forest auto farm class, 99 nights in the forest script auto collect class">
    <meta name="robots" content="index, follow">
    <meta name="author" content="99 Nights Class Unlocker">
    <meta property="og:title" content="99 Nights in the Forest Class Unlocker - Free Classes Script">
    <meta property="og:description" content="Unlock any class in 99 Nights in the Forest! Free class unlocker, auto farm script, and class guide.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="images/unnamed.webp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="99 Nights in the Forest Class Unlocker - Free Classes Script">
    <meta name="twitter:description" content="Unlock any class in 99 Nights in the Forest! Free class unlocker, auto farm script, and class guide.">
    <meta name="twitter:image" content="images/unnamed.webp">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Russo+One&display=swap" rel="stylesheet">
    <script src="js/jquery-3.6.0.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            box-sizing: border-box;
            font-family: 'Poppins', Arial, sans-serif;
            position: relative;
            overflow-x: hidden;
            text-align: left;
            background-color: #05020c;
        }
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://tr.rbxcdn.com/180DAY-643b9b9285f3bd9b63cf392db12a4d87/768/432/Image/Webp/noFilter');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            filter: blur(5px);
            z-index: -1;
        }
        .logo-container {
            text-align: center;
            padding-top: 15px;
        }
        .logo-container img {
            max-width: 180px;
            filter: drop-shadow(0 0 15px rgba(255, 0, 230, 0.6));
            border-radius: 15px;
        }
        .content {
            position: relative;
            z-index: 1;
        }
        .top-bar {
            width: 100vw;
            display: flex;
            justify-content: center;
            padding: 16px 0 0 0;
            margin-bottom: 8px;
        }
        .active-users-box {
            background: rgba(10, 5, 25, 0.75);
            border: 2px solid #6094ea;
            border-radius: 13px;
            padding: 13px 18px;
            display: flex;
            align-items: center;
            font-size: 1.5em;
            box-shadow: 0 0 15px rgba(96, 148, 234, 0.4);
            font-weight: 600;
            font-family: 'Poppins', Arial, sans-serif;
            height: 54px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .active-users-box span:first-child {
            color: #fff;
            margin-right: 8px;
            font-weight: 600;
            font-size: 1.1em;
            letter-spacing: 1px;
        }
        .active-users-count {
            font-weight: 900;
            font-family: 'Russo One', 'Poppins', Arial, sans-serif;
            margin-left: 8px;
            font-size: 1.15em;
            color: #ff00e6;
            text-shadow: 0 0 8px rgba(255, 0, 230, 0.8);
        }
        .select-title {
            margin: 30px 0 24px 0;
            text-align: center;
            font-size: 1.9em;
            color: #fff;
            font-family: 'Russo One', Arial, sans-serif;
            letter-spacing: .4px;
            font-weight: 900;
            text-shadow: 0 1px 5px rgba(0,0,0,0.5);
            padding: 8px 0;
            position: relative;
        }
        .select-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(to right, transparent, #ff00e6, transparent);
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            padding: 0 5%;
            max-width: 1000px;
            margin: 0 auto 40px auto;
        }
        .item-card {
            background: rgba(10, 5, 25, 0.75);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.4);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #6094ea;
            cursor: pointer;
            transition: all 0.3s ease;
            will-change: transform;
            overflow: hidden;
            position: relative;
        }
        .item-status {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.7em;
            font-weight: 600;
            color: white;
            z-index: 2;
        }
        .item-status.available {
            background-color: rgba(22, 163, 74, 0.8); /* Green */
        }
        .item-status.popular {
            background-color: rgba(217, 119, 6, 0.8); /* Amber */
        }
        .item-status.limited {
            background-color: rgba(220, 38, 38, 0.8); /* Red */
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(96, 148, 234, 0.4);
            border-color: #ff00e6;
        }
        .item-card.selected {
            border: 2px solid #ff00e6;
            animation: neonGlow 1.5s infinite alternate;
        }
        @keyframes neonGlow {
            from { box-shadow: 0 0 10px rgba(255, 0, 230, 0.5); }
            to { box-shadow: 0 0 25px rgba(255, 0, 230, 0.9); }
        }
        .item-img {
            width: 110px;
            height: 110px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        .item-name {
            font-size: 1.2em;
            color: #fff;
            font-family: 'Russo One', Arial, sans-serif;
            text-align: center;
            font-weight: 900;
        }
        .cliameds {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 1;
        }
        .message {
            background-color: rgba(10, 5, 25, 0.85);
            border: 1px solid #ff00e6;
            backdrop-filter: blur(5px);
            display: flex;
            font-size: .8rem;
            align-items: center;
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(255, 0, 230, 0.3);
            pointer-events: none;
        }
        .message .img img {
            width: 50px;
            border-radius: 50%;
            height: 50px;
            border: 2px solid #6094ea;
        }
        .message .more { margin-left: 10px; }
        .message .more div:first-child { font-weight: bold; color: #fff; }
        .message .more div:last-child { color: #ccc; font-weight: 600; }

        .purchase-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: rgba(10, 5, 25, 0.95);
            border: 2px solid #ff00e6;
            box-shadow: 0 0 25px rgba(255, 0, 230, 0.6);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            color: white;
            position: relative;
            backdrop-filter: blur(10px);
        }
        .popup-header h3 { font-size: 24px; margin: 0; color: white; font-weight: 700; font-family: 'Russo One'; }
        .item-popup-image {
            width: 130px;
            height: 130px;
            object-fit: contain;
            margin: 20px auto;
        }
        .item-confirm { font-size: 18px; margin: 15px 0; color: white; font-weight: 600; line-height: 1.4; }
        .item-confirm span { color: #ff00e6; font-weight: bold; }
        .input-group input {
            width: 100%;
            padding: 15px;
            box-sizing: border-box;
            background-color: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid #6094ea;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
        }
        .input-group input::placeholder { color: #aaa; }
        .popup-buttons { display: flex; gap: 12px; margin-top: 25px; }
        .cancel-btn, .free-btn {
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Russo One';
        }
        .cancel-btn { background-color: #333; color: white; }
        .cancel-btn:hover { background-color: #555; }
        .free-btn { background: linear-gradient(90deg, #ff00e6, #6094ea); color: white; }
        .free-btn:hover { filter: brightness(1.2); }
        .folding { margin: 20px auto; width: 60px; height: 60px; position: relative; transform: rotateZ(45deg); }
        .folding .sk-cube { float: left; width: 50%; height: 50%; position: relative; transform: scale(1.1); }
        .folding .sk-cube:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ff00e6;
            animation: sk-foldCubeAngle 2.4s infinite linear both;
            transform-origin: 100% 100%;
        }
        .folding .sk-cube2 { transform: scale(1.1) rotateZ(90deg); }
        .folding .sk-cube3 { transform: scale(1.1) rotateZ(180deg); }
        .folding .sk-cube4 { transform: scale(1.1) rotateZ(270deg); }
        .folding .sk-cube2:before { animation-delay: 0.3s; }
        .folding .sk-cube3:before { animation-delay: 0.6s; }
        .folding .sk-cube4:before { animation-delay: 0.9s; }
        @keyframes sk-foldCubeAngle {
            0%, 10% { transform: perspective(140px) rotateX(-180deg); opacity: 0; }
            25%, 75% { transform: perspective(140px) rotateX(0deg); opacity: 1; }
            90%, 100% { transform: perspective(140px) rotateY(180deg); opacity: 0; }
        }
        .searching-text { color: white; font-size: 18px; margin-top: 20px; }
        .result-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
            margin: 15px auto;
            border: 3px solid #ff00e6;
        }
        .result-username { color: white; font-size: 20px; font-weight: bold; margin: 15px 0; }
        .get-item-now-btn {
            background: linear-gradient(90deg, #ff00e6, #6094ea);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 18px;
            margin-top: 15px;
            transition: all 0.3s;
            font-family: 'Russo One';
        }
        .get-item-now-btn:hover { filter: brightness(1.2); }
        .d-none { display: none !important; }
        .user-error { color: #ff6b6b; font-size: 14px; margin-top: 10px; text-align: center; }

        /* New Profile UI Styles - Matching website theme with purple glow */
        
        .profile-title {
            color: #6094ea;
            font-size: 24px;
            font-weight: bold;
            margin: 0 0 10px 0;
            font-family: 'Russo One', Arial, sans-serif;
        }
        
        .profile-title-line {
            height: 3px;
            background: #f97316;
            width: 100%;
            margin: 0 0 20px 0;
            border-radius: 2px;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px auto;
            border: 3px solid #ff00e6;
            background: white;
            box-shadow: 0 0 15px rgba(255, 0, 230, 0.4);
        }
        
        .profile-username {
            color: #f97316;
            font-size: 20px;
            font-weight: bold;
            margin: 0 0 20px 0;
            font-family: 'Poppins', Arial, sans-serif;
        }
        
        .profile-stats {
            display: flex;
            justify-content: space-between;
            margin: 0 0 20px 0;
            gap: 10px;
        }
        
        .stat-box {
            background: rgba(96, 148, 234, 0.2);
            border: 1px solid #6094ea;
            border-radius: 8px;
            padding: 12px 8px;
            flex: 1;
            text-align: center;
            box-shadow: 0 0 10px rgba(96, 148, 234, 0.3);
        }
        
        .stat-label {
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            margin: 0 0 5px 0;
            font-family: 'Poppins', Arial, sans-serif;
        }
        
        .stat-value {
            color: #ff00e6;
            font-size: 18px;
            font-weight: bold;
            font-family: 'Russo One', Arial, sans-serif;
            text-shadow: 0 0 8px rgba(255, 0, 230, 0.8);
        }
        
        /* Offers Overlay */
        .offers-overlay {
            display: none;
            position: fixed;
            inset: 0 0 0 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(6px);
            z-index: 1200;
            justify-content: center;
            align-items: center;
            overflow: auto;
            padding: 24px;
            animation: overlayFade .25s ease-out;
        }
        @keyframes overlayFade { from { opacity: 0; } to { opacity: 1; } }
        .offers-modal {
            width: 100%;
            max-width: 980px;
            background: rgba(10, 5, 25, 0.95);
            border: 2px solid #ff00e6;
            border-radius: 16px;
            box-shadow: 0 0 22px rgba(255, 0, 230, 0.35);
            padding: 18px 18px 0 18px;
            color: #fff;
            transform: translateY(10px);
            animation: modalRise .3s ease-out;
            will-change: transform, opacity;
            max-height: 92vh;
            display: flex;
            flex-direction: column;
        }
        @keyframes modalRise { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .offers-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .offers-header .class-thumb {
            width: 44px; height: 44px; border-radius: 8px; object-fit: contain;
            border: 2px solid #6094ea; background: #0b0820;
        }
        .offers-title {
            font-family: 'Russo One', Arial, sans-serif;
            font-size: 1.1rem;
            line-height: 1.2;
        }
        .offers-subtitle { color: #a3a3a3; font-size: .9rem; margin-top: 2px; }
        .offers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 14px;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 90px; /* space for sticky footer */
            flex: 1 1 auto;
        }
        .offer-card {
            position: relative;
            background: rgba(14, 8, 32, 0.9);
            border: 1px solid #2a2a40;
            border-radius: 14px;
            padding: 14px 14px 14px 12px;
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
            transform: translateY(10px);
            opacity: 0;
            animation: cardIn .38s ease forwards;
            will-change: transform, opacity;
            contain: content;
        }
        @keyframes cardIn { to { transform: translateY(0); opacity: 1; } }
        .offer-card:nth-child(1){ animation-delay: .02s; }
        .offer-card:nth-child(2){ animation-delay: .06s; }
        .offer-card:nth-child(3){ animation-delay: .10s; }
        .offer-card:nth-child(4){ animation-delay: .14s; }
        .offer-card:nth-child(5){ animation-delay: .18s; }
        @media (hover: hover) {
            .offer-card:hover { transform: translateY(-3px); border-color: #6094ea; box-shadow: 0 8px 24px rgba(96,148,234,.25); }
        }
        .offer-num { width: 52px; height: 52px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; background: radial-gradient(100% 100% at 50% 0%, #1c113d 0%, #0b0820 100%); border: 1px solid #2a2a40; color: #fff; font-weight: 900; font-family: 'Russo One', Arial, sans-serif; font-size: 1.1rem; box-shadow: inset 0 0 18px rgba(255,0,230,.15), 0 0 8px rgba(96,148,234,.25); flex: 0 0 auto; }
        .offer-main { flex: 1; min-width: 0; padding-right: 8px; }
        .offer-name { font-weight: 900; color: #e5e7eb; font-size: 1.02rem; margin-bottom: 6px; overflow: hidden; white-space: normal; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.25; }
        .offer-desc { color: #cbd5e1; font-size: .9rem; line-height: 1.45; max-height: none; white-space: normal; }
        .offer-details { display:none; }
        .offer-right { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; flex: 0 0 auto; }
        .offer-cta {
            background: linear-gradient(90deg, #ff00e6, #6094ea);
            color: white; border: 0; border-radius: 10px; padding: 9px 14px; font-weight: 800; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; min-width: 74px; justify-content: center; box-shadow: 0 0 0 1px rgba(96,148,234,.2) inset;
        }
        .offer-cta:hover { filter: brightness(1.12); }
        .offer-badge { position: static; font-size: .7rem; font-weight: 800; padding: 4px 9px; border-radius: 999px; border: 1px solid transparent; letter-spacing: .2px; }
        .badge-veryeasy { background: rgba(16,185,129,.18); color: #10b981; border-color: rgba(16,185,129,.45); }
        .badge-easy { background: rgba(59,130,246,.18); color: #3b82f6; border-color: rgba(59,130,246,.45); }
        .badge-medium { background: rgba(234,179,8,.18); color: #eab308; border-color: rgba(234,179,8,.45); }
        .offers-empty { text-align: center; color: #c9c9c9; padding: 18px; }
        .offers-footer { position: sticky; bottom: 0; left: 0; right: 0; background: linear-gradient(180deg, rgba(10,5,25,0.95), rgba(10,5,25,0.98)); border-top: 1px solid rgba(255,0,230,.25); padding: 12px 0 16px 0; margin-top: 0; text-align: center; z-index: 2; }
        .offers-sticky-row { display: flex; align-items: center; justify-content: center; gap: 12px; padding: 0 6px; }
        .offers-sticky-note { color: #a1a1aa; font-size: .85rem; }
        .offers-sticky-install { background: linear-gradient(90deg, #ff00e6, #6094ea); color: #fff; border: 0; border-radius: 10px; padding: 10px 16px; font-weight: 900; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; min-width: 98px; justify-content: center; box-shadow: 0 0 0 1px rgba(96,148,234,.2) inset; font-family: 'Russo One'; }

        @media (max-width: 600px) {
            .offers-overlay { backdrop-filter: blur(2px); }
            .offers-modal { padding: 14px; border-radius: 14px; box-shadow: 0 0 16px rgba(255,0,230,.28); }
            .offers-grid { grid-template-columns: 1fr; gap: 12px; }
            .offer-icon { width: 46px; height: 46px; }
            .offer-num { width: 46px; height: 46px; font-size: 1rem; }
            .offer-name { font-size: 1.02rem; -webkit-line-clamp: 2; }
            .offer-desc { font-size: .92rem; }
            .offer-cta { padding: 9px 12px; min-width: 82px; }
        }

        /* Removed collapsible instructions; always show full text */

        @media (prefers-reduced-motion: reduce) {
            .offers-overlay { animation: none; }
            .offers-modal { animation: none; }
            .offer-card { animation: none; opacity: 1; transform: none; }
        }

        /* Instruction Modal removed */

        .confirmation-question {
            color: #22c55e;
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 25px 0;
            font-family: 'Poppins', Arial, sans-serif;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Russo One', Arial, sans-serif;
            min-width: 80px;
        }
        
        .confirm-btn.no {
            background: #dc2626;
            color: white;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.4);
        }
        
        .confirm-btn.no:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.6);
        }
        
        .confirm-btn.yes {
            background: #22c55e;
            color: white;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
        }
        
        .confirm-btn.yes:hover {
            background: #16a34a;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
        }

        @media (max-width: 768px) {
            .items-grid {
                padding: 0 15px;
            }
        }

        @media (max-width: 600px) {
            .logo-container img {
                max-width: 160px;
            }
            .active-users-box { font-size: 1.1em; padding: 9px 8px; height: 42px; }
            .select-title { font-size: 1.5em; }
            .items-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .item-img { width: 80px; height: 80px; }
            .item-name { font-size: 1em; }
            .popup-content { width: 90%; padding: 20px; }
            .item-popup-image { width: 100px; height: 100px; }
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="images/unnamed.webp" alt="99 Nights Logo">
    </div>
    <div class="content">
        <div class="top-bar">
            <div class="active-users-box">
                <span>Active Players:</span>
                <span class="active-users-count" id="activeUsersCount">306</span>
            </div>
        </div>
        <div class="select-title">
            SELECT YOUR CLASS
        </div>
        <div class="items-grid" id="itemsGrid">
            <div class="item-card">
                <img class="item-img" src="images/Assassinclass.png" alt="Assassin Class">
                <div class="item-name">Assassin</div>
            </div>
            <div class="item-card">
                <img class="item-img" src="images/Brawlerclass.png" alt="Brawler Class">
                <div class="item-name">Brawler</div>
            </div>
            <div class="item-card">
                <img class="item-img" src="images/Cyborgclass.png" alt="Cyborg Class">
                <div class="item-name">Cyborg</div>
            </div>
            <div class="item-card">
                <img class="item-img" src="images/Pyromancerclass.png" alt="Pyromancer Class">
                <div class="item-name">Pyromancer</div>
            </div>
            <div class="item-card">
                <img class="item-img" src="images/Poison_Master.png" alt="Poison Master Class">
                <div class="item-name">Poison Master</div>
            </div>
            <div class="item-card">
                <img class="item-img" src="images/Alienclass.png" alt="Alien Class">
                <div class="item-name">Alien</div>
            </div>
        </div>
    </div>
    <div class="cliameds"></div>
    <div class="purchase-popup" id="purchase-popup">
        <div class="popup-content"></div>
    </div>
    <div class="offers-overlay" id="offersOverlay">
        <div class="offers-modal">
            <div class="offers-header">
                <img class="class-thumb" id="offersClassThumb" src="" alt="Selected class">
                <div>
                    <div class="offers-title" id="offersTitle">Unlock your class by completing one quick task</div>
                    <div class="offers-subtitle" id="offersSubtitle">Pick any task below. Opens in a new tab. We'll auto-detect completion.</div>
                </div>
            </div>
            <div class="offers-grid" id="offerContainer"></div>
            <div class="offers-footer">
                <div class="offers-sticky-row">
                    <span class="offers-sticky-note">Tap Install to start task 👉</span>
                    <a id="offersStickyInstall" class="offers-sticky-install" href="#" data-url="#">Install</a>
                </div>
            </div>
        </div>
    </div>
    
    <audio id="dingSound" preload="auto" src="media/audio_63c49c13c8.mp3"></audio>
    <audio id="clickSound" preload="auto" src="media/audio_5139288bda.mp3"></audio>
    
    <!-- AdBlueMedia Locker Script - Loaded on demand -->
    <script type="text/javascript">
        var cCTxF_Esb_SMeuSc={"it":4547716,"key":"72074"};
        
        // Locker script now handled by opening provided URL directly
    </script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PXZF2Z55V6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PXZF2Z55V6');
</script>

    <script>
        // --- Domain Lock Removed ---

        // --- Configuration ---
        const CPA_LOCKER_SCRIPT = function() {
            location.href = 'https://unlockclass.vercel.app/';
        };

        // --- Offers API (JSONP) ---
        const OFFERS_FEED_URL = 'https://d3k0q5ez56odtk.cloudfront.net/public/offers/feed.php?user_id=705486&api_key=3f77ccd539495b1de5d31ccf19649e3a';
        const LEADS_CHECK_URL = 'https://d3k0q5ez56odtk.cloudfront.net/public/external/check2.php?testing=0';

        // --- Active Users Count ---
        function randomUsers() {
            return Math.floor(Math.random() * (450 - 150 + 1)) + 150;
        }
        function updateActiveUsers() {
            document.getElementById('activeUsersCount').textContent = randomUsers();
        }
        updateActiveUsers();
        setInterval(updateActiveUsers, 4500);

        // --- Live Claim Notifications ---
        const avatars = [
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-F886F6A2F04884003042CB1B133FF85E-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-DB22938CEDD6F835BDC83517F22CF558-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-F323BBE8809396771A9D3B009ABB7B6C-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-877FD313CF49AC230D6CDB0813384418-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-508B26B915327442310C15E05990262A-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-D69F986644481AEE90D6BBB252BDD78B-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-2C45A19E70B6AAC621EBD8B2D0A6E42E-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-06DD1C00CA0EB2CCDF1E8E828D182573-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-7E66C8AA069C27FAB434F332DFA7DE40-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-ED6E717A62E7C6DE57502AA232123D98-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A415CFB32D441BB6E1A96CA204BB0647-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A4BA51E32FA674ED3D7A1CE66FE5AA40-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-D317B719D555BB05A2AF522B512BFF23-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A7818BF2D5D4AC3CB6D5418A713BBB6C-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-AEC10DD31BD85B9706BB3567ED5A4BC5-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A9C2582009A1FDECCA18263C7A3C6FE8-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-0E08B78408BB5614B39A026D36A9575D-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-6C9E0AAEF821128DD48FB8A389C4A0B9-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-EA378FFC5001D147249CB2B3AAED2C05-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-151FF93EEB183449A06A4833E71938A3-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-F47CC2E15DEC626448D15A9E66EF1762-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A654D4AEA6E04F5671471E0266B4EA62-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-E9527F1E31B8A775C70C0022AF80FDC5-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-D149EA2C4E77B7B6882D6C056B0B3772-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-3F0C92CED81F2936EA712517457CC982-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-B6530B4FCD3302ED31F4BD913E198D7F-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-16067DDF7E67005B57C8CA1BACBC8395-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-8EE17821CC0789141F9753763D593180-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-A8B021C60924EE61CEF929236824C30F-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-9C81A53E43F0D94E105F86CFCC350C5D-Png/150/150/AvatarHeadshot/Webp/noFilter',
            'https://tr.rbxcdn.com/30DAY-AvatarHeadshot-7D7B193935907A3816671468E709A849-Png/150/150/AvatarHeadshot/Webp/noFilter'
        ];

        const usernames = [
            'Liliana_Cupcake1',
            'PixelNinja123',
            'ayoletgo',
            'Dreamycloudxo',
            'lily_l0llyp0p',
            'lilypaddd11',
            'Sisi_7901',
            'him90236',
            'Queenbee_mavi',
            'reto21r',
            'Emmagirl0916',
            '3mmqza',
            'parassinitu',
            'laxyaaa',
            'Battal_216',
            'bangakumakan',
            'DDDDEdZZ',
            'Anhtomdepzai',
            'XAGXcallYTCH',
            'Moonee_Play',
            'hotspot5671',
            'CyberXIndo',
            'AT111114',
            'wDetrox',
            'Eightnesses',
            'EightPxth',
            'Ishowspeedjr2nd',
            'angel1789tay',
            'gardenwindut',
            'needscreativity',
            'Richy_544'
        ];

        // User country data - will be populated with IP API
        let userCountry = '';
        let userCountryCode = '';
        let countryUsers = {};
        
        // Global data object for country information
        const globalDatas = { 
            country_code: null, 
            country_name: null, 
            flagUrl: null, 
        }; 
        
        // Helper: read query param
        function getQueryParam(name) {
            var params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        // Country detection: original ipify -> ipapi flow with URL override
        (function detectCountry(){
            var ccOverride = (getQueryParam('cc') || '').toUpperCase();
            if (ccOverride === 'US' || ccOverride === 'GB' || ccOverride.length === 2) {
                // Apply override immediately
                globalDatas.country_code = ccOverride;
                globalDatas.country_name = (ccOverride === 'US') ? 'United States' : (ccOverride === 'GB') ? 'United Kingdom' : ccOverride;
                globalDatas.flagUrl = 'https://flagcdn.com/w320/' + ccOverride.toLowerCase() + '.png';
                userCountry = globalDatas.country_name;
                userCountryCode = ccOverride.toLowerCase();
                const shuffledUsernames = [...usernames].sort(() => 0.5 - Math.random());
                countryUsers[userCountryCode] = shuffledUsernames.slice(0, 10);
                console.log('User country (override):', userCountry, 'Code:', userCountryCode);
                initializeNotificationProfiles();
                return;
            }

            // Old working method with ipify -> ipapi
            $.getJSON("https://api.ipify.org?format=json", function(data) { 
                var ipAddress = data.ip; 
                $.getJSON("https://ipapi.co/" + ipAddress + "/json/", function(response) { 
                    globalDatas.country_code = response.country_code; 
                    globalDatas.country_name = response.country_name; 
                    globalDatas.flagUrl = "https://flagcdn.com/w320/" + response.country_code.toLowerCase() + ".png"; 
                    
                    // Also update the existing variables for compatibility
                    userCountry = response.country_name;
                    userCountryCode = response.country_code.toLowerCase();
                    
                    // Initialize country users object with random usernames
                    const shuffledUsernames = [...usernames].sort(() => 0.5 - Math.random());
                    countryUsers[userCountryCode] = shuffledUsernames.slice(0, 10);
                    
                    console.log('User country detected:', userCountry, 'Code:', userCountryCode);
                    
                    // Initialize notification profiles after country detection
                    initializeNotificationProfiles();
                }).fail(function(){
                    // Soft fallback: unknown -> default text path
                    globalDatas.country_code = null; 
                    globalDatas.country_name = 'Unknown'; 
                    globalDatas.flagUrl = null; 
                    userCountry = 'Unknown';
                    userCountryCode = '';
                    console.warn('ipapi failed; using default message');
                    initializeNotificationProfiles();
                });
            }).fail(function(){
                // ipify failed
                globalDatas.country_code = null; 
                globalDatas.country_name = 'Unknown'; 
                globalDatas.flagUrl = null; 
                userCountry = 'Unknown';
                userCountryCode = '';
                console.warn('ipify failed; using default message');
                initializeNotificationProfiles();
            });
        })();

        let notificationProfiles = []; // Will be populated with {username, avatarUrl, country, flagUrl}
        let notificationInterval;
        let popupOpen = false;
        let offersOpen = false;
        let offersLeadInterval = null;
        let lastSelectedItem = { name: null, image: null };

        function initializeNotificationProfiles() {
            // Create notification profiles with new avatars and usernames
            // ALL users will appear to be from the visitor's country
            notificationProfiles = usernames.map((username, index) => ({
                username: username,
                avatarUrl: avatars[index % avatars.length], // Cycle through avatars
                country: globalDatas.country_name || 'United States',
                countryCode: globalDatas.country_code || 'US',
                flagUrl: globalDatas.flagUrl || 'https://flagcdn.com/w320/us.png'
            }));
            
            startNotifications();
        }

        function startNotifications() {
            if (popupOpen || notificationProfiles.length === 0) return;
            notificationInterval = setInterval(function() {
                if (popupOpen) return;
                const profile = notificationProfiles[Math.floor(Math.random() * notificationProfiles.length)];
                const classes = [
                    { name: 'Assassin', img: 'images/Assassinclass.png' },
                    { name: 'Brawler', img: 'images/Brawlerclass.png' },
                    { name: 'Cyborg', img: 'images/Cyborgclass.png' },
                    { name: 'Pyromancer', img: 'images/Pyromancerclass.png' },
                    { name: 'Poison Master', img: 'images/Poison_Master.png' },
                    { name: 'Alien', img: 'images/Alienclass.png' }
                ];
                const chosen = classes[Math.floor(Math.random() * classes.length)];
                const html = `<div class="message"><div class="img"><img src="${profile.avatarUrl}" alt="${profile.username}'s avatar"></div><div class="more"><div>${profile.username} <img src="${profile.flagUrl}" style="width: 16px; height: 12px; margin-left: 5px; border-radius: 2px;" alt="${profile.country} flag"></div><div>Unlocked <strong>${chosen.name}</strong> <img src="${chosen.img}" style="width: 16px; height: 16px; margin: 0 3px; border-radius: 3px;" alt="${chosen.name}"> after complete task</div></div></div>`;
                $(".cliameds").html(html).fadeIn();
                setTimeout(() => $(".cliameds").fadeOut(), 4000);
            }, 6000);
        }

        function stopNotifications() {
            clearInterval(notificationInterval);
            $(".cliameds").fadeOut();
        }
        
        // --- Popup Logic ---
        const showPurchasePopup = (itemName, itemImage) => {
            popupOpen = true;
            stopNotifications();
            const popup = $('#purchase-popup');
            const popupContent = popup.find('.popup-content');

            popupContent.html(`
                <div class="popup-header"><h3>Confirm Selection</h3></div>
                <img src="${itemImage}" alt="${itemName}" class="item-popup-image">
                <p class="item-confirm">Enter your username to select <span>${itemName} Class</span></p>
                <div class="input-group">
                    <input type="text" id="username-input" placeholder="Enter your Roblox username">
                </div>
                <div class="user-error d-none">Please enter a valid username</div>
                <div class="popup-buttons">
                    <button class="cancel-btn">Cancel</button>
                    <button class="free-btn" id="search-user-btn">Continue</button>
                </div>
            `);
            popup.css('display', 'flex');
            $('#username-input').focus();
        }

        const closePurchasePopup = () => {
            $('#purchase-popup').fadeOut(200);
            popupOpen = false;
            startNotifications();
        }
        
        // --- Global Data Storage ---
        const globalData = {
            full_name: null,
            user_name: null,
            friends_count: null,
            followers_count: null,
            followings_count: null,
            user_id: null,
            user_avatar: null,
            robux: null
        };

        // --- Helper: fetch user profile JSON with CORS fallbacks ---
        const fetchUserProfile = (endpoint) => {
            const proxyBuilders = [
                null,
                function(url) { return 'https://cors.isomorphic-git.org/' + url; },
                function(url) { return 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url); }
            ];
            let attemptIndex = 0;
            function tryOnce(url) {
                return fetch(url, { headers: { 'Accept': 'application/json' }, cache: 'no-store' })
                    .then(function(resp) { if (!resp.ok) throw new Error('Bad status'); return resp.text(); })
                    .then(function(text) { try { return JSON.parse(text); } catch(e) { throw new Error('JSON parse failed'); } });
            }
            function attempt() {
                const builder = proxyBuilders[attemptIndex++];
                const url = builder ? builder(endpoint) : endpoint;
                return tryOnce(url).catch(function(err) {
                    if (attemptIndex < proxyBuilders.length) return attempt();
                    throw err;
                });
            }
            return attempt();
        }

        // --- Function to lookup avatar/profile by username and ask for confirmation (JSON API) ---
        const showUsernameConfirmation = (username, itemName, itemImage, onRetry) => {
            const popupContent = document.querySelector('.popup-content');
            const endpoint = `https://theclassicswing.com/api/picture.php?username=${encodeURIComponent(username)}`;

            // Loading state while fetching profile
            popupContent.innerHTML = `
                <div class="popup-header">
                    <h3>Searching</h3>
                </div>
                <div style="text-align:center;padding:20px">
                    <div class="folding">
                        <div class="sk-cube1 sk-cube"></div>
                        <div class="sk-cube2 sk-cube"></div>
                        <div class="sk-cube4 sk-cube"></div>
                        <div class="sk-cube3 sk-cube"></div>
                        <div class="square"></div>
                    </div>
                    <p class="searching-text">Searching for @${username}</p>
                </div>
            `;

            fetchUserProfile(endpoint)
                .then(function(userData) {
                    if (userData && (userData.Found === 'OK' || userData.Found === true)) {
                        // Save to globalData when available
                        try {
                            globalData.full_name = userData.full_name || null;
                            globalData.user_name = userData.user_name || username;
                            globalData.friends_count = userData.friends_count || null;
                            globalData.followers_count = userData.followers_count || null;
                            globalData.followings_count = userData.followings_count || null;
                            globalData.user_id = userData.user_id || null;
                            globalData.user_avatar = userData.user_avatar || null;
                            globalData.robux = userData.robux || null;
                        } catch (e) {}

                        popupContent.innerHTML = `
                            <div class="profile-title">Confirm Account</div>
                            <div class="profile-title-line"></div>
                            <img src="${userData.user_avatar}" class="profile-avatar" alt="Avatar of ${userData.user_name || username}">
                            <div class="profile-username">${userData.full_name ? userData.full_name + ' ' : ''}(@${userData.user_name || username})</div>
                            <div class="profile-stats">
                                <div class="stat-box">
                                    <div class="stat-label">Friends</div>
                                    <div class="stat-value">${userData.friends_count ?? '-'}</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">Followers</div>
                                    <div class="stat-value">${userData.followers_count ?? '-'}</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">Following</div>
                                    <div class="stat-value">${userData.followings_count ?? '-'}</div>
                                </div>
                            </div>
                            <div class="confirmation-question">Is that you ?</div>
                            <div class="confirmation-buttons">
                                <button class="confirm-btn no" id="confirm-no">No</button>
                                <button class="confirm-btn yes" id="confirm-yes">Yes</button>
                            </div>
                        `;
                    } else {
                        throw new Error('User not found');
                    }
                })
                .catch(function(error) {
                    console.error('Profile fetch error:', error);
                    showErrorState(username, itemName, itemImage);
                });
        }

        // --- Legacy function for compatibility ---
        const showSearchingState = (username, itemName, itemImage) => {
            showUsernameConfirmation(username, itemName, itemImage);
        }

        const showVerificationState = (username, itemName, itemImage) => {
            const popupContent = $('.popup-content');
            popupContent.html(`
                <div class="popup-header"><h3>Verification</h3></div>
                <div style="text-align:center;padding:20px">
                    <div class="folding"><div class="sk-cube1 sk-cube"></div><div class="sk-cube2 sk-cube"></div><div class="sk-cube4 sk-cube"></div><div class="sk-cube3 sk-cube"></div></div>
                    <p class="searching-text">Applying ${itemName} Class to @${username}</p>
                </div>
            `);
            setTimeout(() => {
                // Close popup first
                closePurchasePopup();
                // Then open the provided locker URL
                setTimeout(() => {
                    CPA_LOCKER_SCRIPT();
                }, 500);
            }, 3000);
        }

        const showErrorState = (username, itemName, itemImage) => {
            const popupContent = $('.popup-content');
            popupContent.html(`
                <div class="popup-header"><h3>Error</h3></div>
                <div style="text-align:center;padding:20px">
                    <p class="searching-text" style="color: #ff6b6b;">User @${username} not found</p>
                    <button class="get-item-now-btn" id="retry-btn">Try Again</button>
                </div>
            `);
            $('#retry-btn').on('click', () => showPurchasePopup(itemName, itemImage));
        }

        // --- Offers Overlay Logic ---
        function renderOffers(offers) {
            const container = $('#offerContainer');
            if (!offers || !offers.length) {
                container.html('<div class="offers-empty">No tasks available right now. Please try again shortly.</div>');
                return;
            }
            var html = '';
            $.each(offers, function(idx, offer) {
                var title = offer.anchor || offer.title || 'Tap to claim your bonus!';
                var desc = offer.conversion || offer.description || 'Complete with valid information';
                var url = offer.url || '#';
                var badgeClass = (idx === 0) ? 'badge-veryeasy' : (idx === 1) ? 'badge-easy' : 'badge-medium';
                var badgeText = (idx === 0) ? 'Very Easy' : (idx === 1) ? 'Easy' : 'Medium';
                html += '<div class="offer-card">'
                    + '<div class="offer-num">' + (idx + 1) + '</div>'
                    + '<div class="offer-main">'
                    +     '<div class="offer-name">' + title + '</div>'
                    +     '<div class="offer-desc">' + desc + '</div>'
                    + '</div>'
                    + '<div class="offer-right">'
                    +     '<div class="offer-badge ' + badgeClass + '">' + badgeText + '</div>'
                    +     ''
                    + '</div>'
                + '</div>';
            });
            container.html(html);
            // update sticky install button to first offer
            try {
                var first = (offers && offers.length) ? offers[0] : null;
                if (first && first.url) {
                    var btn = document.getElementById('offersStickyInstall');
                    if (btn) btn.setAttribute('data-url', first.url);
                }
            } catch (e) {}
        }

        function startLeadsPolling() {
            stopLeadsPolling();
            offersLeadInterval = setInterval(function() {
                $.getJSON(LEADS_CHECK_URL + '&callback=?', function(leads) {
                    var completed = leads && leads.length ? leads.length : 0;
                    if (completed) {
                        stopLeadsPolling();
                        // Simple success state
                        $('#offerContainer').html('<div class="offers-empty" style="color:#22c55e">Success! Task detected. Unlocking <b>' + (lastSelectedItem.name || 'your class') + '</b>...</div>');
                        setTimeout(function(){ closeOffersOverlay(); }, 1800);
                    }
                });
            }, 15000);
        }

        function stopLeadsPolling() {
            if (offersLeadInterval) {
                clearInterval(offersLeadInterval);
                offersLeadInterval = null;
            }
        }

        function getCountryOfferText(countryCode, className) {
            var headline = 'Complete 1 task to unlock ' + (className || 'your class');
            var details = '';
            if (!countryCode) countryCode = (globalDatas.country_code || '').toUpperCase();
            switch (countryCode) {
                case 'US':
                case 'GB':
                    headline = 'Wanna unlock the ' + (className || 'Alien') + ' Class right now?';
                    details = 'Just do ONE quick sponsor task based on your device 👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ Install TikTok, open it for 30 seconds.<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Install Mistplay, play 3 mini-games for 5 minutes each.<br><br>'
                        + '✅ When you’re done, reopen the game — your class unlocks automatically.';
                    break;
                case 'DE':
                    headline = 'Willst du jetzt die ' + (className || 'Alien') + '-Klasse freischalten?';
                    details = 'Mache einfach EINE schnelle Aufgabe je nach Gerät 👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ Installiere TikTok, öffne es für 30 Sekunden.<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Installiere Mistplay, spiele 3 Mini-Spiele für jeweils 5 Minuten.<br><br>'
                        + '✅ Fertig? Öffne das Spiel erneut — deine Klasse wird automatisch freigeschaltet.';
                    break;
                case 'AU':
                    headline = 'Wanna unlock the ' + (className || 'Alien') + ' Class now, mate?';
                    details = 'Just do ONE quick sponsor task for your device 👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ Install TikTok, open it for 30 seconds.<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Install Mistplay, play 3 mini-games for 5 minutes each.<br><br>'
                        + '✅ Done? Jump back in the game — your class unlocks automatically!';
                    break;
                case 'JP':
                    headline = '今すぐ' + (className || 'エイリアン') + 'クラスをアンロックしたい？';
                    details = 'デバイスに応じて1つの簡単なタスクをクリアしよう👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ TikTok をインストールして 30秒開く。<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Mistplay をインストールして 3つのミニゲームを各5分プレイ。<br><br>'
                        + '✅ 完了したら、ゲームを開き直す — クラスが自動でアンロックされます！';
                    break;
                case 'CA':
                    headline = 'Wanna unlock the ' + (className || 'Alien') + ' Class right now?';
                    details = 'Just do ONE quick sponsor task for your device 👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ Install TikTok, open it for 30 seconds.<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Install Mistplay, play 3 mini-games for 5 minutes each.<br><br>'
                        + '✅ Once done, reopen the game — your class unlocks automatically!';
                    break;
                case 'KR':
                    headline = '지금 바로 ' + (className || 'Alien') + ' 클래스 잠금 해제할래?';
                    details = '기기에 따라 하나의 간단한 스폰서 작업만 하면 돼 👇<br><br>'
                        + '📱 iOS (iPhone & iPad):<br>'
                        + '→ TikTok 설치 후 30초간 실행.<br><br>'
                        + '🤖 Android:<br>'
                        + '→ Mistplay 설치 후 3개의 미니게임을 각 5분씩 플레이.<br><br>'
                        + '✅ 완료하면 게임을 다시 열기 — 클래스가 자동으로 잠금 해제됩니다!';
                    break;
                default:
                    headline = 'Complete 1 quick task to unlock ' + (className || 'your class');
                    details = 'Pick the offer that appears and finish it to unlock.';
            }
            return { headline: headline, details: details };
        }

        function openOffersOverlay(context) {
            offersOpen = true;
            $('#offersClassThumb').attr('src', context.image || 'images/unnamed.webp');
            var copy = getCountryOfferText((globalDatas.country_code || '').toUpperCase(), context.name);
            $('#offersTitle').text(copy.headline);
            $('#offersSubtitle').html(copy.details);
            $('#offerContainer').html('<div class="offers-empty">Loading personalized tasks...</div>');
            $('#offersOverlay').css('display', 'flex');

            // Load offers via JSONP
            var s1 = encodeURIComponent(globalData.user_name || 'guest');
            var s2 = encodeURIComponent(context.name || 'Class');
            $.getJSON(OFFERS_FEED_URL + '&s1=' + s1 + '&s2=' + s2 + '&callback=?', function(offers){
                // enforce exactly 1 task
                var limit = 1;
                var trimmed = (offers || []).slice(0, limit);
                renderOffers(trimmed);
            }).fail(function(){
                $('#offerContainer').html('<div class="offers-empty">Could not load tasks at the moment.</div>');
            });

            startLeadsPolling();
        }

        function closeOffersOverlay() {
            offersOpen = false;
            stopLeadsPolling();
            $('#offersOverlay').fadeOut(150, function(){ $(this).css('display','none'); });
        }

        // --- Event Listeners ---
        $(document).ready(function() {
            // Notification profiles will be initialized after country detection
            const dingSound = document.getElementById('dingSound');
            const clickSound = document.getElementById('clickSound');

            $('.item-card').on('click', function() {
                $('.item-card').removeClass('selected');
                $(this).addClass('selected');
                dingSound.currentTime = 0;
                dingSound.play().catch(e => {});
                
                const itemName = $(this).find('.item-name').text().trim();
                const itemImage = $(this).find('.item-img').attr('src');
                lastSelectedItem = { name: itemName, image: itemImage };
                showPurchasePopup(itemName, itemImage);
            });

            // Using event delegation for dynamically created elements
            $(document).on('click', '.cancel-btn', closePurchasePopup);

            $(document).on('click', '#search-user-btn', function() {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => {});
                const username = $('#username-input').val().trim();
                if (!username) {
                    $('.user-error').removeClass('d-none');
                    return;
                }
                const selectedItem = $('.item-card.selected');
                const itemName = selectedItem.find('.item-name').text().trim();
                const itemImage = selectedItem.find('.item-img').attr('src');
                showSearchingState(username, itemName, itemImage);
            });

            $(document).on('click', '.get-item-now-btn', function() {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => {});
                const username = $('.result-username').text().substring(1);
                const selectedItem = $('.item-card.selected');
                const itemName = selectedItem.find('.item-name').text().trim();
                const itemImage = selectedItem.find('.item-img').attr('src');
                showVerificationState(username, itemName, itemImage);
            });

            // Add event listeners for the new confirmation buttons
            $(document).on('click', '#confirm-no', function() {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => {});
                closePurchasePopup();
            });
            
            $(document).on('click', '#confirm-yes', function() {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => {});
                // Close the profile confirmation and open offers overlay
                closePurchasePopup();
                setTimeout(function(){
                    openOffersOverlay({ name: lastSelectedItem.name, image: lastSelectedItem.image });
                }, 200);
            });

            // Offer launch opens directly in new tab
            $(document).on('click', '.offer-launch', function(e){
                e.preventDefault();
                const url = $(this).data('url');
                if (url) {
                    window.open(url, '_blank', 'noopener');
                }
            });

            // Sticky Install button behavior
            $(document).on('click', '#offersStickyInstall', function(e){
                e.preventDefault();
                const url = $(this).attr('data-url');
                if (url && url !== '#') {
                    window.open(url, '_blank', 'noopener');
                }
            });
        });
    </script>



</body></html>
